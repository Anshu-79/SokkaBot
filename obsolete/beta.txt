import discord
from discord.ext import commands
import json
from keep_alive import keep_alive
import os
import requests

botToken = os.environ['botToken']
intents = discord.Intents.default()
intents.members = True
#client = discord.Client(intents=intents)
bot = commands.Bot(command_prefix="$")

water_tribe_gif = "https://media3.giphy.com/media/J5deqXb35R6hDQHJJV/giphy.gif"

def get_joke():
  response = requests.get("https://v2.jokeapi.dev/joke/Miscellaneous,Dark,Pun,Spooky?blacklistFlags=nsfw,racist,sexist,explicit&type=single")
  json_data = json.loads(response.text)
  joke_string = json_data['joke']
  return joke_string

@bot.command()
async def gif(ctx):
  embed = discord.Embed(
    title = '',
    description = "",
    colour = discord.Colour.blue())
  embed.set_image(url=water_tribe_gif)
  await ctx.send(embed=embed)

@bot.event
async def on_ready():
  print("\nI'm ready & logged in as {0.user}!".format(bot))

@bot.event
async def on_member_join(member):
  channel = bot.get_channel(843500905123020802)
  await channel.send("""What's up, {0.name}? I'm Sokka client from the Southern Water Tribe.\nI can do a bunch of totally random weird stuff. To know more about that type "$help".\nAnd if there's something that I can't do, well, blame @Anshu79 for that.""".format(member))

@bot.event
async def on_message(message):
  await bot.process_commands(message)
  if message.author == bot:
    return

  #print(client.users)

  if message.content.startswith('$hello'):
    await message.channel.send(f"Hello, {message.author.name}!")

  if message.content.startswith('$help'):
    await message.channel.send("""
Type "$joke" to hear a joke.
Type "$hello" to well... make me say hello.""")
  
  if message.content.startswith('$joke'):
    await message.channel.send(get_joke())


keep_alive()
#bot.run(botToken)
bot.run(botToken)

